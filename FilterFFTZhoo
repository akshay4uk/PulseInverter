% Daten laden
load('Messdaten.mat');
load('Devabsolute.mat');

% Entwurf eines Tiefpass-Butterworth-Filters
Ordnung = 4; % Filterordnung
Grenzfrequenz = 0.05; % Grenzfrequenz nach Bedarf anpassen

[b_tiefpass, a_tiefpass] = butter(Ordnung, Grenzfrequenz, 'low');

% Anwendung des Tiefpassfilters auf das Signal unter Verwendung von filtfilt
gefiltertes_signal_tiefpass = filtfilt(b_tiefpass, a_tiefpass, Dev_absolute_D);

% Darstellung des Original- und gefilterten Signals in einem Diagramm
figure;

% Originalsignal plotten
plot(n_mech_extern(:,2), Dev_absolute_D, '-b', 'LineWidth', 1.5, 'DisplayName', 'Originalsignal');
hold on;

% Gefiltertes Tiefpasssignal plotten
plot(n_mech_extern(:,2), gefiltertes_signal_tiefpass, '-g', 'LineWidth', 1.5, 'DisplayName', 'Tiefpass-gefiltertes Signal');

% Vertikale Linien zur Anzeige der Grenzfrequenz hinzufügen
line([0 400], [Grenzfrequenz Grenzfrequenz], 'Color', 'r', 'LineStyle', '--', 'DisplayName', 'Grenzfrequenz');

% Bereich unterhalb des Originalsignals hervorheben
flaechen_unten_hervorheben(n_mech_extern(:,2), Dev_absolute_D, 0, 'b', 0.1, 'Originalbereich');

hold off;

xlim([0 400]);
ylim([0 max(Dev_absolute_D) + 5]); % y-Achsenbegrenzung nach Bedarf anpassen
title("Original- und Tiefpass-gefilterte Signale");
xlabel("Zeit in s");
ylabel("Abweichung");
legend('Location', 'northeast');
grid;

% Anmerkungen hinzufügen
text(150, Grenzfrequenz + 1, sprintf('Grenzfrequenz: %.2f Hz', Grenzfrequenz), 'Color', 'r');

% Funktion zum Hervorheben des Bereichs unterhalb einer Linie
function flaechen_unten_hervorheben(x, y, baseline, farbe, alpha, displayName)
    x_fuellung = [x; flipud(x)];
    y_fuellung = [y; baseline*ones(size(y))];
    fill(x_fuellung, y_fuellung, farbe, 'FaceAlpha', alpha, 'EdgeColor', 'none', 'DisplayName', displayName);
end
