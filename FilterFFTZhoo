% Load data
load('Messdaten.mat');
load('Devabsolute.mat');

% Designing a low-pass Butterworth filter
order = 4; % Filter order
cutoff_frequency = 0.05; % Adjust the cutoff frequency as needed

[b_lowpass, a_lowpass] = butter(order, cutoff_frequency, 'low');

% Applying the low-pass filter to the signal using filtfilt
filtered_signal_lowpass = filtfilt(b_lowpass, a_lowpass, Dev_absolute_D);

% Plotting the original and filtered signals on the same graph
figure;

% Plot original signal
plot(n_mech_extern(:,2), Dev_absolute_D, '-b', 'LineWidth', 1.5, 'DisplayName', 'Original Signal');
hold on;

% Plot low-pass filtered signal
plot(n_mech_extern(:,2), filtered_signal_lowpass, '-g', 'LineWidth', 1.5, 'DisplayName', 'Low-Pass Filtered Signal');

% Add vertical lines indicating the cutoff frequency
line([0 400], [cutoff_frequency cutoff_frequency], 'Color', 'r', 'LineStyle', '--', 'DisplayName', 'Cutoff Frequency');

hold off;

% Highlight the shaded region for the filtered signal
x_fill = [n_mech_extern(1,2), n_mech_extern(end,2), n_mech_extern(end,2), n_mech_extern(1,2)];
y_fill = [min(Dev_absolute_D), min(Dev_absolute_D), max(Dev_absolute_D), max(Dev_absolute_D)];
patch(x_fill, y_fill, 'g', 'FaceAlpha', 0.2, 'EdgeColor', 'none', 'DisplayName', 'Filtered Region');

xlim([0 400]);
ylim([0 max(Dev_absolute_D)]); % Adjust the y-axis limits as needed
title("Original and Low-Pass Filtered Signals");
xlabel("Time in s");
ylabel("Deviation");
legend('Location', 'northeast');
grid;

% Add annotations
text(150, cutoff_frequency + 1, sprintf('Cutoff Frequency: %.2f Hz', cutoff_frequency), 'Color', 'r');
text(50, max(Dev_absolute_D) - 2, 'Filtered Region', 'Color', 'g');
