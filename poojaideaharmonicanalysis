% Load data from Messdaten.mat
load('Messdaten.mat');

% Define the time range of interest
start_time = 86.566; % Start time in seconds
end_time = 86.616;   % End time in seconds

% Extract data within the specified time range
time_range_indices = frq_el_intern(:,2) >= start_time & frq_el_intern(:,2) <= end_time;
Frequenz = frq_el_intern(time_range_indices, 1);
Zeit = frq_el_intern(time_range_indices, 2); % Extract time data

% Specify the pulses per revolution
pulses_per_revolution = 4;

% Define fundamental frequencies for each case
fundamental_frequencies = [66, 200, 400, 600, 5]; % Hz
num_cases = length(fundamental_frequencies);

% Initialize arrays to store harmonic magnitudes for each case
num_harmonics = 6;
harmonic_magnitudes_all = zeros(num_cases, num_harmonics);

% Perform harmonic analysis for each case
for c = 1:num_cases
    % Calculate rotor speed (RPM) of the motor for current case
    RPM = (Frequenz * 60) / pulses_per_revolution;

    % Define fundamental frequency for current case
    fundamental_frequency = fundamental_frequencies(c);

    % Define harmonic frequencies for current case
    harmonic_frequencies = fundamental_frequency * (1:num_harmonics);

    % Perform harmonic analysis for current case
    for i = 1:num_harmonics
        harmonic_magnitudes_all(c, i) = max(abs(RPM - i * fundamental_frequency));
    end
end

% Display harmonic analysis results for each case
disp('Harmonic Analysis Results:');
disp('--------------------------');
disp('Case   Harmonic   Frequency (RPM)   Magnitude');
for c = 1:num_cases
    for i = 1:num_harmonics
        fprintf('%d \t %d \t %10.2f \t %10.4f\n', c, i, harmonic_frequencies(i), harmonic_magnitudes_all(c, i));
    end
end

% Plot the harmonic analysis results for each case
figure;
hold on;
colors = {'r', 'g', 'b', 'm', 'c'};
for c = 1:num_cases
    plot(harmonic_frequencies, harmonic_magnitudes_all(c, :), 'Color', colors{c}, 'Marker', 'o', 'LineStyle', 'none', 'DisplayName', ['Case ', num2str(c)]);
end
xlabel('Frequency (RPM)');
ylabel('Magnitude');
title('Harmonic Analysis of Rotor Speed (RPM) for Different Fundamental Frequencies');
grid on;
legend('Location', 'best');
hold off;

% Save the plot as PNG file
print('-dpng', 'Harmonic_Analysis_Rotor_Speed_Cases.png');
